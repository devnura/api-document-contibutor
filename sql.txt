
select
	tdd.*,
	detail_doc.b_approve
from
	t_d_document tdd
join (
	select
		*
	from
		t_d_document_detail tddd2
	where
--	ambil i_stat di bawahnya
		i_stat in (
			select
--				replace((i_stat - 1)::varchar, '0', '1')::bigint
				i_stat - 2
			from
				doc.t_d_document_detail tddd
			where
				i_user = 2
		)
--		ambil document code dari user yang terlibat
		and c_document_code in (
			select
				c_document_code
			from
				doc.t_d_document_detail tddd
			where
				i_user = 2
		)
--		ambil dokumen yang udah approve
		and b_approve = true
		
		union
		
--		ambil document i_stat 1 dan belum approve
		select * from t_d_document_detail tddd 
		where i_stat = 2
		--		ambil document code dari user yang terlibat
		and c_document_code in (
			select
				c_document_code
			from
				doc.t_d_document_detail tddd
			where
				i_user = 2
		)
) as detail_doc on
	detail_doc.c_document_code = tdd.c_document_code